<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Profil & Pengaturan</title>

  <!-- AlpineJS + Font Awesome + Font -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/src/css/profile2.css">
</head>


<body>
  <div class="container"
       x-data="{
          activeTab: 'profile',
          user: {},
          fotoPreview: '',
          loading: true,
          error: null,
          success: null,

          async init() {
            try {
              const res = await fetch('/api/profile');
              const json = await res.json();
              if (!res.ok || json.error) throw new Error(json.error || 'Gagal memuat data');
              this.user = json.data;
            } catch (e) {
              this.error = 'Gagal memuat data profil';
            } finally {
              this.loading = false;
            }
          },

          gantiFoto(event) {
            const file = event.target.files[0];
            if (file) {
              this.fotoPreview = URL.createObjectURL(file);
              // Upload ke server kalau perlu
              // const formData = new FormData();
              // formData.append('foto', file);
              // fetch('/api/update-foto', { method: 'POST', body: formData });
            }
          }
       }"
       x-init="init()"
       x-cloak>

    <!-- Header -->
    <header class="page-header">
      <button class="back-btn" @click="window.location.href='/'" aria-label="Kembali">
        <i class="fa-solid fa-arrow-left"></i>
      </button>

      <div class="header-content">
        <h1 class="page-title">Profil & Pengaturan</h1>
        <p class="page-subtitle">Kelola informasi akun dan preferensi Anda.</p>
      </div>
    </header>

    <!-- Tabs -->
    <div class="tab-container">
      <button class="tab-button" 
              :class="{'active': activeTab === 'profile'}" 
              @click="activeTab = 'profile'">
        <i class="fa-regular fa-user mr-2"></i> Profil Saya
      </button>
      <button class="tab-button"
              :class="{'active': activeTab === 'mentor'}"
              @click="activeTab = 'mentor'">
        <i class="fa-solid fa-chalkboard-user mr-2"></i> Mentor
      </button>
      <button class="tab-button"
              :class="{'active': activeTab === 'activity'}"
              @click="activeTab = 'activity'">
        <i class="fa-solid fa-clock-rotate-left mr-2"></i> Aktivitas
      </button>
    </div>

    <!-- Profile -->
    <section x-show="activeTab === 'profile'" x-transition>
      <template x-if="!loading">
        <div class="profile-card">
          
          <div class="profile-header-section">
            <div class="profile-image-wrapper">
              <img 
                :src="fotoPreview || user.foto_url" 
                alt="Foto Profil" 
                class="profile-image" 
              >
              <label for="fotoInput" class="edit-avatar-btn" title="Ganti Foto">
                <i class="fa-solid fa-camera"></i>
              </label>
              <input id="fotoInput" type="file" accept="image/*" @change="gantiFoto" style="display: none;">
            </div>

            <div class="user-info">
              <span class="user-role-badge" x-text="user.role || 'Pengguna'"></span>
              <h2 x-text="user.nama_lengkap"></h2>
              <p class="user-email-text">
                <i class="fa-regular fa-envelope"></i>
                <span x-text="user.email"></span>
              </p>
            </div>
          </div>

          <form class="profile-form" @submit.prevent>
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Nama Lengkap</label>
                <input type="text" class="form-input" x-model="user.nama_lengkap">
              </div>

              <div class="form-group">
                <label class="form-label">Nomor Telepon</label>
                <input type="tel" class="form-input" x-model="user.kontak" placeholder="+62">
              </div>

              <div class="form-group full-width">
                <label class="form-label">Bio</label>
                <textarea rows="4" x-model="user.bio" placeholder="Ceritakan sedikit tentang diri Anda..."></textarea>
              </div>

              <div class="form-group">
                <label class="form-label">Jenis Kelamin</label>
                <input type="text" class="form-input" x-model="user.jenis_kelamin" disabled>
              </div>

              <div class="form-group">
                <label class="form-label">Afiliasi</label>
                <input type="text" class="form-input" x-model="user.afiliasi" disabled>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="save-btn" @click="axios.put('/api/pengguna/update', user)">
                <i class="fa-solid fa-check mr-2"></i> Simpan Perubahan
              </button>
            </div>

            <div x-show="success" class="alert alert-success" x-transition>
              <i class="fa-solid fa-circle-check"></i>
              <span x-text="success"></span>
            </div>
            <div x-show="error" class="alert alert-error" x-transition>
              <i class="fa-solid fa-circle-exclamation"></i>
              <span x-text="error"></span>
            </div>
          </form>
        </div>
      </template>

      <div x-show="loading" class="loading-state">
        <i class="fa-solid fa-circle-notch fa-spin loading-spinner"></i>
        <p class="mt-4">Sedang memuat data...</p>
      </div>
    </section>

    <!-- Mentor -->
    <section x-show="activeTab === 'mentor'" x-transition>
      <div class="profile-card empty-state">
        <div class="empty-icon-wrapper primary">
          <i class="fa-solid fa-chalkboard-user"></i>
        </div>
        <h2>Daftar Sebagai Mentor</h2>
        <p class="empty-text-body">Bagikan ilmu dan pengalaman Anda kepada komunitas. Jadilah mentor dan bantu orang lain belajar.</p>
        <a href="/daftar-mentor" class="save-btn link-btn">
          Daftar Sekarang <i class="fa-solid fa-arrow-right ml-2"></i>
        </a>
      </div>
    </section>

    <!-- Activity -->
    <section x-show="activeTab === 'activity'" x-transition>
      <div class="profile-card empty-state">
         <div class="empty-icon-wrapper neutral">
          <i class="fa-solid fa-clock-rotate-left"></i>
        </div>
        <h2>Riwayat Aktivitas</h2>
        <p class="text-muted">Belum ada aktivitas terbaru yang tercatat.</p>
      </div>
    </section>
  </div>
</body>
</html>